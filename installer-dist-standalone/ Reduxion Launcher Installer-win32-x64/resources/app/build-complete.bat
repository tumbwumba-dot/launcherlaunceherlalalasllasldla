@echo off
chcp 65001 > nul
title –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ Reduxion Launcher - Complete Build

echo ========================================
echo   –ü–û–õ–ù–ê–Ø –°–ë–û–†–ö–ê REDUXION LAUNCHER
echo ========================================
echo.
echo üöÄ –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞
echo üì¶ –õ–∞—É–Ω—á–µ—Ä + –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ + –ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
echo.
echo ========================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤
echo [–®–ê–ì 1/7] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤...
echo.

set "ERRORS_FOUND=0"

echo –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –ª–∞—É–Ω—á–µ—Ä–∞...
if not exist "modern-launcher.html" (
    echo ‚ùå –§–∞–π–ª modern-launcher.html –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a "ERRORS_FOUND+=1"
)

if not exist "modern-styles.css" (
    echo ‚ùå –§–∞–π–ª modern-styles.css –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a "ERRORS_FOUND+=1"
)

echo –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞...
if not exist "installer.html" (
    echo ‚ùå –§–∞–π–ª installer.html –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a "ERRORS_FOUND+=1"
)

if not exist "installer-styles.css" (
    echo ‚ùå –§–∞–π–ª installer-styles.css –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a "ERRORS_FOUND+=1"
)

if not exist "installer-main.js" (
    echo ‚ùå –§–∞–π–ª installer-main.js –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a "ERRORS_FOUND+=1"
)

echo –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...
if not exist "package.json" (
    echo ‚ùå –§–∞–π–ª package.json –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a "ERRORS_FOUND+=1"
)

if not exist "package-installer.json" (
    echo ‚ùå –§–∞–π–ª package-installer.json –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a "ERRORS_FOUND+=1"
)

if %ERRORS_FOUND% GTR 0 (
    echo.
    echo ‚ùå –ù–∞–π–¥–µ–Ω–æ %ERRORS_FOUND% –æ—à–∏–±–æ–∫ –≤ —Ñ–∞–π–ª–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞!
    echo –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–±–æ—Ä–∫—É –∑–∞–Ω–æ–≤–æ.
    pause
    exit /b 1
)

echo ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã
echo.

REM –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–±–æ—Ä–æ–∫
echo [–®–ê–ì 2/7] –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–±–æ—Ä–æ–∫...
echo.

if exist "dist" (
    echo –û—á–∏—Å—Ç–∫–∞ –ø–∞–ø–∫–∏ dist...
    rmdir /s /q "dist" 2>nul
)

if exist "installer-dist" (
    echo –û—á–∏—Å—Ç–∫–∞ –ø–∞–ø–∫–∏ installer-dist...
    rmdir /s /q "installer-dist" 2>nul
)

if exist "build" (
    echo –û—á–∏—Å—Ç–∫–∞ –ø–∞–ø–∫–∏ build...
    rmdir /s /q "build" 2>nul
)

echo ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
echo.

REM –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo [–®–ê–ì 3/7] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...
echo.

if not exist "node_modules" (
    echo –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...
    call npm install
    if errorlevel 1 (
        echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!
        pause
        exit /b 1
    )
) else (
    echo ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
)

REM –£—Å—Ç–∞–Ω–æ–≤–∫–∞ electron-builder –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
call npm list electron-builder >nul 2>&1
if errorlevel 1 (
    echo –£—Å—Ç–∞–Ω–æ–≤–∫–∞ electron-builder...
    call npm install electron-builder --save-dev
    if errorlevel 1 (
        echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ electron-builder!
        pause
        exit /b 1
    )
)

echo ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≥–æ—Ç–æ–≤—ã
echo.

REM –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
echo [–®–ê–ì 4/7] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...
echo.

REM –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ—Å—É—Ä—Å–æ–≤
if not exist "assets" (
    echo –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤...
    mkdir "assets" 2>nul
)

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–∫–æ–Ω–∫–∏
if not exist "assets\icon.svg" (
    echo ‚ö†Ô∏è –ò–∫–æ–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
) else (
    echo ‚úÖ –ò–∫–æ–Ω–∫–∞ –Ω–∞–π–¥–µ–Ω–∞
)

echo ‚úÖ –†–µ—Å—É—Ä—Å—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã
echo.

REM –°–±–æ—Ä–∫–∞ –ª–∞—É–Ω—á–µ—Ä–∞
echo [–®–ê–ì 5/7] –°–±–æ—Ä–∫–∞ –ª–∞—É–Ω—á–µ—Ä–∞...
echo ========================================
echo.

echo –°–±–æ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ª–∞—É–Ω—á–µ—Ä–∞...
call npm run build-win
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –ª–∞—É–Ω—á–µ—Ä–∞!
    echo –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–±—Ä–∞—Ç—å –ª–∞—É–Ω—á–µ—Ä –æ—Ç–¥–µ–ª—å–Ω–æ —Å –ø–æ–º–æ—â—å—é build-launcher.bat
    pause
    exit /b 1
)

echo ‚úÖ –õ–∞—É–Ω—á–µ—Ä —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ
echo.

REM –°–±–æ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞
echo [–®–ê–ì 6/7] –°–±–æ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞...
echo ========================================
echo.

echo –°–±–æ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞ –ª–∞—É–Ω—á–µ—Ä–∞...
call npx electron-builder --config package-installer.json --win --publish=never
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞!
    echo –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–±—Ä–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –æ—Ç–¥–µ–ª—å–Ω–æ —Å –ø–æ–º–æ—â—å—é build-installer.bat
    pause
    exit /b 1
)

echo ‚úÖ –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ
echo.

REM –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç—á–µ—Ç
echo [–®–ê–ì 7/7] –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç—á–µ—Ç...
echo ========================================
echo.

set "BUILD_SUCCESS=1"

echo –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–∫–∏ –ª–∞—É–Ω—á–µ—Ä–∞ (dist)...
if exist "dist" (
    echo ‚úÖ –ü–∞–ø–∫–∞ dist —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    dir /b "dist" | findstr /c:".exe" >nul
    if not errorlevel 1 (
        echo ‚úÖ –ù–∞–π–¥–µ–Ω—ã exe —Ñ–∞–π–ª—ã –ª–∞—É–Ω—á–µ—Ä–∞
    ) else (
        echo ‚ö†Ô∏è EXE —Ñ–∞–π–ª—ã –ª–∞—É–Ω—á–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
        set "BUILD_SUCCESS=0"
    )
) else (
    echo ‚ùå –ü–∞–ø–∫–∞ dist –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
    set "BUILD_SUCCESS=0"
)

echo.
echo –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–∫–∏ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞ (installer-dist)...
if exist "installer-dist" (
    echo ‚úÖ –ü–∞–ø–∫–∞ installer-dist —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    dir /b "installer-dist" | findstr /c:".exe" >nul
    if not errorlevel 1 (
        echo ‚úÖ –ù–∞–π–¥–µ–Ω—ã exe —Ñ–∞–π–ª—ã —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞
    ) else (
        echo ‚ö†Ô∏è EXE —Ñ–∞–π–ª—ã —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
        set "BUILD_SUCCESS=0"
    )
) else (
    echo ‚ùå –ü–∞–ø–∫–∞ installer-dist –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
    set "BUILD_SUCCESS=0"
)

echo.
echo ========================================
echo           –û–¢–ß–ï–¢ –°–ë–û–†–ö–ò
echo ========================================
echo.

if %BUILD_SUCCESS% EQU 1 (
    echo üéâ –ü–û–õ–ù–ê–Ø –°–ë–û–†–ö–ê –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–ê!
    echo.
    echo üì¶ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:
    echo.

    echo üìÅ –õ–ê–£–ù–ß–ï–† (–ø–∞–ø–∫–∞ 'dist'):
    if exist "dist" (
        echo   –§–∞–π–ª—ã:
        dir /b "dist" 2>nul | findstr /c:".exe" || echo   –ù–µ—Ç exe —Ñ–∞–π–ª–æ–≤
        echo.
        echo   –î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã:
        dir /b "dist" 2>nul | findstr /v /c:".exe" || echo   –ù–µ—Ç –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤
    )

    echo.
    echo üìÅ –£–°–¢–ê–ù–û–í–©–ò–ö (–ø–∞–ø–∫–∞ 'installer-dist'):
    if exist "installer-dist" (
        echo   –§–∞–π–ª—ã:
        dir /b "installer-dist" 2>nul | findstr /c:".exe" || echo   –ù–µ—Ç exe —Ñ–∞–π–ª–æ–≤
        echo.
        echo   –î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã:
        dir /b "installer-dist" 2>nul | findstr /v /c:".exe" || echo   –ù–µ—Ç –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤
    )

    echo.
    echo üöÄ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
    echo.
    echo 1Ô∏è‚É£ –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ª–∞—É–Ω—á–µ—Ä–∞:
    echo    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ 'dist'
    echo    - –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ —Å–æ–∑–¥–∞–µ—Ç —è—Ä–ª—ã–∫–∏ –≤ –º–µ–Ω—é –ü—É—Å–∫ –∏ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ
    echo    - –ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    echo.
    echo 2Ô∏è‚É£ –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞:
    echo    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ 'installer-dist'
    echo    - –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ —Å–∫–∞—á–∏–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –ª–∞—É–Ω—á–µ—Ä–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
    echo    - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É
    echo.
    echo 3Ô∏è‚É£ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
    echo    - npm start - –∑–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    echo    - npm run build-win - —Å–±–æ—Ä–∫–∞ –ª–∞—É–Ω—á–µ—Ä–∞
    echo    - build-launcher.bat - —É–ª—É—á—à–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ –ª–∞—É–Ω—á–µ—Ä–∞
    echo    - build-installer.bat - —Å–±–æ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞
    echo.

) else (
    echo ‚ùå –°–ë–û–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê –° –û–®–ò–ë–ö–ê–ú–ò!
    echo.
    echo üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:
    echo.
    echo 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤
    echo 2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    echo 3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–±—Ä–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
    echo 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –≤—ã—à–µ
    echo.
    echo üîÑ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –°–ü–û–°–û–ë–´ –°–ë–û–†–ö–ò:
    echo.
    echo - build-launcher.bat (—Ç–æ–ª—å–∫–æ –ª–∞—É–Ω—á–µ—Ä)
    echo - build-installer.bat (—Ç–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫)
    echo - npm run build-win (–±–∞–∑–æ–≤–∞—è —Å–±–æ—Ä–∫–∞)
    echo.
)

echo ========================================
echo –ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞ —Å–±–æ—Ä–∫–∏
echo ========================================
echo.

REM –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞–ø–æ–∫ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
if %BUILD_SUCCESS% EQU 1 (
    echo.
    set /p "OPEN_FOLDERS=–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–±–æ—Ä–∫–∏? (y/n): "
    if /i "!OPEN_FOLDERS!"=="y" (
        if exist "dist" start "" "dist"
        if exist "installer-dist" start "" "installer-dist"
    )
)

echo.
pause